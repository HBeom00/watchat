# <img width="142" alt="logo" src="https://github.com/user-attachments/assets/83f03335-5067-4a1f-96c8-d3b872a1c56e">

<img width="1920" alt="notion_thumbnail_3" src="https://github.com/user-attachments/assets/270fccf8-972b-478f-a968-db151e2b31c7">

<br/>

# 🔗 배포 링크

➡️ [Watchat 바로가기](https://watchat.vercel.app/)

<br/>

# 👨‍🏫 프로젝트 소개

### 같이 영상을 시청하며 실시간으로 대화를 나눌 수 있는 영상 메이트를 찾는 서비스</br>

- **TMDB API**를 활용하여 받아온 영상 데이터를 기반으로 **파티 모집**을 할 수 있어요!</br>
- 모집 중인 파티에 참가하여 참여 중인 사람들과 **실시간으로 소통**할 수 있어요!</br>
- 팔로우 및 초대하기 기능으로 **원하는 사람**과 **비공개 파티**를 생성하여 영상을 시청할 수 있어요!</br>
- 영상 시청 종료 후, 파티원에 대한 **후기 작성**을 하여 평가할 수 있어요!

<br/>

# 🫂 팀원 소개

|              |                                                                                        김경혜                                                                                        |                                                                                         홍연주                                                                                          |                                                                                              김태흔                                                                                               |                                                                                         신희범                                                                                          |                                                                                        이현주                                                                                         |
| :----------: | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | :-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | :-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|   <b>역할    |                                                                                       리더/FE                                                                                        |                                                                                        부리더/FE                                                                                        |                                                                                              팀원/FE                                                                                              |                                                                                         팀원/FE                                                                                         |                                                                                        팀원/DS                                                                                        |
| <b>담당 업무 |                                                                              메인페이지</br>상세페이지                                                                               |                                                                               마이페이지</br>프로필 편집                                                                                |                                                                                   레이아웃</br>파티 모집 페이지                                                                                   |                                                                             실시간 채팅</br>로그인/로그아웃                                                                             |                                                                               UX 기획</br>와이어프레임                                                                                |
|  <b>Github   |                                                               <a href=https://github.com/nangnanang> @nangnanang </a>                                                                |                                                                     <a href=https://github.com/play93> @play93 </a>                                                                     |                                                                       <a href=https://github.com/taeheun01> @taeheun01 </a>                                                                       |                                                                    <a href=https://github.com/HBeom00> @HBeom00 </a>                                                                    |                                                                 <a href=https://blog.naver.com/wezzzle> @wezzzle </a>                                                                 |
|   <b>Blog    | <a href=https://fpzmfks.tistory.com/> <img src="https://img.shields.io/badge/Tistory-000000?style=for-the-badge&logo=Tistory&logoColor=white&link=https://fpzmfks.tistory.com"> </a> | <a href=https://playhong.tistory.com/> <img src="https://img.shields.io/badge/Tistory-000000?style=for-the-badge&logo=Tistory&logoColor=white&link=https://playhong.tistory.com/"> </a> | <a href=https://earl-grey-tea.tistory.com/> <img src="https://img.shields.io/badge/Tistory-000000?style=for-the-badge&logo=Tistory&logoColor=white&link=https://earl-grey-tea.tistory.com/"> </a> | <a href=https://velog.io/@hbeom00/posts> <img src="https://img.shields.io/badge/Velog-20C997?style=for-the-badge&logo=Velog&logoColor=white&link=https://velog.io/@hbeom00/posts"> </a> | <a href=https://blog.naver.com/wezzzle> <img src="https://img.shields.io/badge/Velog-20C997?style=for-the-badge&logo=Velog&logoColor=white&link=https://blog.naver.com/wezzzle"> </a> |

#### 📆 팀 노션 : [팀 노션 바로가기](https://www.notion.so/teamsparta/5-5-1222dc3ef51481a587efd07a9090088f)

#### 👀 원페이지 노션 : [원페이지 노션 바로가기](https://teamsparta.notion.site/5-Watchat-02ce60fd27864eed9d8c97dbfdbb1a90)

#### 🪶 깃허브 주소 : [깃허브 바로가기](https://github.com/HBeom00/watchat)

<br/>

# 🔥 페이지별 주요 기능

<details>
<summary>소셜 로그인/회원가입</summary>
 
<img width="1920" alt="로그인" src="https://github.com/user-attachments/assets/01a34595-9a49-43f4-a696-7a3fab51c97a">

- 간단한 유효성 검사를 거쳐서 회원가입을 할 수 있습니다.
- 구글, 카카오톡을 통한 소셜 로그인이 가능합니다.
- 로그인/회원가입 실패 시, 하단에 에러 문구를 띄워줍니다.
- 최초 로그인 시, 랜덤 닉네임과 기본 프로필 이미지가 자동으로 부여됩니다.

</details>

<details>
<summary>메인페이지</summary>

<img width="1921" alt="메인 페이지" src="https://github.com/user-attachments/assets/78b21a8e-c68d-417f-9fcf-738017046d85">

- 검색 기능을 통해 원하는 영상의 파티가 존재하는지 확인할 수 있습니다.
- 캐러셀의 이미지를 클릭하면 해당 이미지의 보충 설명이 담겨 있는 노션 페이지로 이동합니다.
- 드롭 박스로 필터링을 통해 나열 방식과 구독 채널을 원하는 형식으로 파티 리스트를 확인할 수 있습니다.
- 페이지네이션을 통해 파티 리스트를 더욱 간편하게 확인할 수 있습니다.

</details>

<details>
<summary>마이페이지</summary>
  
<img width="1921" alt="마이페이지" src="https://github.com/user-attachments/assets/8680674c-abfd-424a-8839-e38947360854">
<img width="1921" alt="마이페이지-팔로우" src="https://github.com/user-attachments/assets/bf5103b0-8eb5-4d47-ad3c-cea51155e52b">
<img width="1921" alt="마이페이지-매너온도" src="https://github.com/user-attachments/assets/8aecfbfd-40a6-4cea-a187-c6b597cb262f">

- 프로필 편집으로 프로필 이미지, 닉네임, 장르, 플랫폼을 재설정 할 수 있습니다.
- 설정한 장르/플랫폼에 따라 파티를 추천받을 수 있습니다.
- 자신의 매너 온도 지수와, 팔로우한 유저를 확인할 수 있습니다.
- 종료된 파티에서 후기 작성을 통해 참여한 유저를 평가할 수 있습니다.
- 전에 함께 파티에 참여한 유저들을 팔로우 할 수 있습니다.
- 차단된 유저, 이미 팔로우된 유저는 필터링으로 보여지지 않습니다.
- 참여한 파티, 주최한 파티를 확인할 수 있습니다.
- 파티 정보는 최대 4개씩 캐러셀 형식으로 보여지고 있으며, 더보기를 눌러서 전체 파티를 확인할 수 있습니다.
- 초대받은 파티를 확인할 수 있으며, 수락/거절이 가능합니다.

</details>

<details>
<summary>파티 모집 페이지</summary>
 
<img width="1921" alt="모집하기 01" src="https://github.com/user-attachments/assets/5968340a-11da-42e1-b165-4a0f2b39b835">
<img width="1921" alt="모집하기 02" src="https://github.com/user-attachments/assets/5eff120d-8d70-41fb-8ec3-78c1f3b44155">

- 파티 모집을 위한 제목, 내용, 영상을 입력합니다.
- 원하는 영상을 입력하면 자동으로 회차, 러닝 타임, 플랫폼, 이미지가 띄워집니다.
- TMDB API에서 러닝 타임을 제공하지 않는 영상이 있다면 수동으로 입력할 수 있습니다.
- 공개 여부를 통해서 파티를 공개, 비공개 처리가 가능합니다.
- 비공개된 파티는 초대받은 사람만 입장할 수 있습니다.
- 인원 제한, 날짜, 시간을 작성하여 파티 정보를 설정할 수 있습니다.

</details>

<details>
<summary>파티 상세 페이지</summary>
 
<img width="1921" alt="상세페이지 01" src="https://github.com/user-attachments/assets/da881c49-b0a8-4aab-a611-92eb8efdcfc3">
<img width="1921" alt="상세페이지 02" src="https://github.com/user-attachments/assets/f171e9fe-b6b5-4f3c-b59c-1009a6dc27aa">

- 파티 정보와 프로그램 정보, 참여한 유저를 확인할 수 있습니다.
- 초대하기 버튼으로 내가 팔로우한 유저를 파티에 초대할 수 있습니다.
- 참여하기 버튼 클릭 시, 멀티 프로필을 설정할 수 있는 모달 창이 뜹니다.
- 멀티 프로필을 원하지 않으면 기존 유저 정보로 등록됩니다.
- 영상 시작 10분 전부터 채팅방에 입장할 수 있습니다.

</details>

<details>
<summary>실시간 채팅 페이지</summary>
 
<img width="1920" alt="라이브 채팅" src="https://github.com/user-attachments/assets/13ca897d-bbc7-45fa-87f0-dd4296c285c7">

- 파티에 참가한 유저들과 실시간 소통이 가능합니다.
- 재생바를 통해서 영상 진도율을 확인할 수 있습니다.
- 사이드바를 통해서 현재 참가한 멤버 리스트를 볼 수 있습니다.
- 파티 관리자는 팔로우, 언팔로우, 멤버 내보내기를 할 수 있습니다.
- 파티 참가자는 팔로우, 언팔로우, 파티 나가기를 할 수 있습니다.
- 관리자로 인해 쫓겨난 참가자는 다시 채팅방에 접속할 수 없습니다.

</details>

<br/>

# 🤷‍♂️ 기술적 의사결정

**개발 환경 - NextJS**

> 메인페이지, 마이페이지에서 대량의 이미지를 불러와야했는데, nextjs에서 제공하는 Image컴포넌트를 활용해 추가작업 없이 webp와 같은 최신 이미지 포맷으로 자동 변환이 가능해 쉽게 이미지의 크기를 대폭 줄여 (PNG보다 최대 26%, JPEG보다 최대 34% 작은 크기라고 하네요) 성능을 개선할 수 있었다.

**개발 편의성 - Typescript**

> 명시적인 타입 설정이 가능해 코드 가독성이 높고 디버깅과 코드 유지 보수에 용이하다.

**서버 상태 관리 - TanstackQuery**

> TanStack Query를 사용하여 데이터 캐싱, 로딩 및 오류 관리, UI 상태 업데이트를 효율적으로 처리하면서, 기존의 useState와 useEffect로 관리하던 비효율적인 상태 관리를 개선할 수 있었다. 이를 통해 코드의 가독성과 유지보수성을 높이고, 성능 최적화와 더 나은 사용자 경험을 구현할 수 있었다.

**클라이언트 상태 관리 - Zustand**

> 단순하고 경량화된 상태관리 라이브러리로 Rudux보다 간결한 코드를 사용해 짧은 시간 내에 전역상태관리 시스템을 안정적으로 구축해 관리할 수 있다.

**폼 최적화 - React-Hook-form**

> useForm을 사용하여 폼 관리를 간단하고 효율적으로 할 수 있고, 의존성과 코드 크기가 작아 성능 최적화 하기 좋았다. 또한 유효성 검사 라이브러리와 밀접한 관계를 가지고 있어 폼과 유효성 관리를 간편하게 처리할 수 있었다.

**유효성 검사 - Zod**

> 스키마에서 추론한 타입을 그대로 사용할 수 있어 코드 안정성을 높여주었고, 클라이언트와 서버 양쪽에서 데이터 검증에 유용하여 로그인/회원가입 로직에서 쉽게 유효성 처리하였다.

**CSS - tailwind CSS**

> tailwind.config.js 파일을 사용한 반응형 커스터마이징이 가능해 모바일환경을 구현할 때, 클래스명 앞에 mobile: 을 붙여 직관적으로 알 수 있어서 좋았다. shadcn이나 embla캐러셀같은 ui라이브러리를 많이 사용했는데 이런 ui 라이브러리들과의 연동성이 좋아 부담없이 사용할 수 있어서 좋았다.

**백엔드 - Supabase**

> 유용한 메서트와 보안관리 기능을 제공하여 데이터 필터링, 페이지네이션, 데이터 접근 제어 등을 용이하게 처리 가능함. 또한 Realtime서비스를 통한 실시간 데이터 업데이트를 지원하여 실시간 채팅을 구현할 수 있다.

**캐러셀 - Embla Carusel**

> 커스터마이징에 최적화된 라이브러리로, 다양한 설정을 통해 디자인 요구 사항에 맞춘 슬라이더 기능을 구현하기 쉬움. 특히 css라이브러리로 선택한 Tailwind CSS와 호환되어 디자인과 기능적 요소를 일치 시킬 수 있었음.

**프로젝트 파일 관리 - Github**

> 코드 형상 관리를 통해 코드 안정성을 확보하고, 이슈 트래킹과 마일스톤 기능을 통해 프로젝트 진행 상황을 효율적으로 관리 가능함. 원격 협업을 위한 최적의 버전 관리 시스템으로 지속적 통합 및 배포 환경 구축에 유리함.

<br/>

# ⏰ 개발 기간

1. **사전 기획** (10/18 ~ 10/23) : 프로젝트 기획, 주제 선정, 역할 배분, 와이어프레임, 프로젝트 세팅
2. **기능 개발** (10/23 ~ 11/08) : 기능 개발, 필수 구현사항(MVP)완료, 기본 CSS 적용, 배포
3. **UT 테스트** (11/09 ~ 11/13) : UT테스트를 통해 사용자 경험 수집
4. **추가 개발** (11/09 ~ 11/21) : 수집한 내용을 바탕으로 개선 및 추가 기능 개발, 반응형 적용

<br/>

# 🔱 아키텍쳐

![image (1)](https://github.com/user-attachments/assets/a2cf0411-ec64-484a-8d7d-8d8daded39ce)

<br/>

# ⚙️ ERD 설계도

![Untitled (1)](https://github.com/user-attachments/assets/fa680445-ffa9-4367-8a4a-876f554d325f)

<br/>

# 💻 기술 스택

<div>
 <h3>와이어 프레임</h3>
 <img src="https://img.shields.io/badge/Figma-F24E1E?style=for-the-badge&logo=Figma&logoColor=white">
</div>

<div>
 <h3>패키지 매니저</h3>
 <img src="https://img.shields.io/badge/yarn-%232C8EBB.svg?style=for-the-badge&logo=yarn&logoColor=white">
</div>

<div>
 <h3>품질 도구</h3>
 <img src="https://img.shields.io/badge/Prettier-F7B93E?style=for-the-badge&logo=Prettier&logoColor=white">
 <img src="https://img.shields.io/badge/Eslint-4B32C3?style=for-the-badge&logo=Eslint&logoColor=white">
</div>

<div>
 <h3>프레임워크 및 라이브러리</h3>
 <img src="https://img.shields.io/badge/React-20232A?style=for-the-badge&logo=react&logoColor=61DAFB">
 <img src="https://img.shields.io/badge/Next.js-000000?style=for-the-badge&logo=Next.js&logoColor=white">
 <img src="https://img.shields.io/badge/TypeScript-007ACC?style=for-the-badge&logo=typescript&logoColor=white">
 <img src="https://img.shields.io/badge/React%20Hook%20Form-%23EC5990.svg?style=for-the-badge&logo=reacthookform&logoColor=white">
 <img src="https://img.shields.io/badge/zod-%233068b7.svg?style=for-the-badge&logo=zod&logoColor=white">
 <img src="https://img.shields.io/badge/Tailwind CSS-06B6D4?style=for-the-badge&logo=Tailwind CSS&logoColor=white">
</div>

<div>
 <h3>상태 관리</h3>
 <img src="https://img.shields.io/badge/-React%20Query-FF4154?style=for-the-badge&logo=react%20query&logoColor=white">
 <img src="https://img.shields.io/badge/Zustand-06B6D4?style=for-the-badge&logo=Zustand&logoColor=white">
</div>

<div>
 <h3>형상 관리</h3>
 <img src="https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=Git&logoColor=white">
 <img src="https://img.shields.io/badge/Github-181717?style=for-the-badge&logo=Github&logoColor=white">
</div>

<div>
 <h3>데이터베이스</h3>
 <img src="https://img.shields.io/badge/Supabase-181818?style=for-the-badge&logo=supabase&logoColor=white">
</div>

<div>
 <h3>배포</h3>
 <img src="https://img.shields.io/badge/Vercel-000000?style=for-the-badge&logo=Vercel&logoColor=white">
</div>

<div>
 <h3>협업툴</h3>
 <img src="https://img.shields.io/badge/Slack-4A154B?style=for-the-badge&logo=slack&logoColor=white">
 <img src="https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=notion&logoColor=white">
</div>

</br>

# ❣️ 트러블 슈팅

<details>
<summary>다른 채팅방과 채팅이 공유되는 이슈</summary>
 
<br>*원인*<br>
- 실시간 메세지를 구독할 채널명을 'chat'으로 해줬는데 이렇게 되면 모든 채팅방의 채널명이 같아져서 채팅이 공유되는 것이였다.

<br>_해결과정_<br>

```javascript
const messageSubscription = browserClient
      .channel(`chat-${roomId}`)
      .on(
        'postgres_changes',
        { event: 'INSERT', schema: 'public', table: 'chat', filter: `room_id=eq.${roomId}` },
        (payload) => {
          displayNewMessage(payload.new as ChatInfo);
        }
      )
      .on(
        'postgres_changes',
        { event: 'INSERT', schema: 'public', table: 'team_user_profile', filter: `party_id=eq.${roomId}` },
        (payload) => {
          addNewUserInfo(payload.new as UserInfo)})
```

- 채널명에 고유한 값인 'roomId'를 넣어줘서 겹치지 않게 만들어줬고, on 메서드 안에도 filter 기능을 추가해서 roomId가 같은 채팅방만 구독하게 만들어줬다.

</details>

<details>
<summary> 참가하기 모달 창 오류</summary>

- 참가하기 모달 창은 총 3군데에서 사용되고 한 곳에서는 사용자가 함부로 닫을 수 없지만 나머지 2곳에서는 마음대로 닫을 수 있어야 한다. 때문에 openclose trigger를 컨트롤 할 수 있도록 했다. 이를 고려하여 구성한 모달 창이 button태그 중복 사용으로 인한 chlid props 오류가 떠서 refactoring을 하게 되었다.

  해결책들

  1.  chlid의 버튼 태그를 div 태그로(실패)
  2.  트리거를 따로 만들기(성공)
  3.  2개의 open 컨트롤 상태값 합치기(성공)

1. 첫번째 해결책은 트리거 버튼이 비동기 통신 로직을 가지고 있기 때문에 button 태그의 disabled 기능이 필요해서 기각되었다.
2. 두번째 해결책은 얼추 성공하였는데 모달창으로 버튼을 감싸지 말고 모달창과 버튼을 따로 두는 방법을 선택했다. chlid props를 내려주지 않기 때문에 button 태그를 중복으로 사용하는 문제는 해결했다. 또한 별도로 존재하는 모달창의 트리거 버튼을 안 보이게 했다.
3. 세번째 해결책으로 인해 최종적으로 모달 창 조정을 마쳤다. 기존에 open과 openControl이라는 2개의 상태값을 통해 모달 창을 컨트롤 했는데 이를 하나로 합치고 onOpenChange에서 이를 사용처에 따라 다르게 컨트롤 하도록 하였다.

```
<Dialog
        open={openControl}
        onOpenChange={() => {
          if (openControl && path.includes('/recruit')) {
            return setOpenControl(true);
          }
          return setOpenControl(!openControl);
        }}
      >
```

</details>

<details>
<summary>장르를 이용한 추천 파티에서 필터링한 파티를 불러오지 못하는 문제</summary>

<br>**문제 원인**<br>

- Supabase에 배열로 데이터를 담으면 해당 컬럼엔 [”사과”, “바나나”] 처럼 배열로 잘 담긴것 처럼 보이지만 실제로는 “[”사과”, “바나나”]" 이렇게 문자열로 들어감

<br>**해결 방법**<br>

- 함수별로 콘솔로그를 찍어 데이터를 확인함.

```javascript
console.log('유저데이터를 잘 가져옴', userData);
console.log('유저 장르 정보:', userGenre);
console.log('파티 정보도 불러왔음', partyData);
console.log('파티 장르가 어떻게 찍히나', party.genres);
console.log('변환된 장르:', party, transformedGenres);
console.log('유저와 일치하는 장르 있는지:', isMatch);
console.log('장르만 필터링 한 목록을 가져오고', filterGenre);
console.log('모집중이거나 시청중인거만 또 필터링을 해', filterActiveParty);
```

여기서 일치하는 장르가 있는지 확인했을 때, true로 있는 것을 확인했지만 이후 필터링한 목록을 불러오지 못함.

- 파티 장르가 어떻게 찍히는지 확인 </br>
  ![image (2)](https://github.com/user-attachments/assets/ee25ca4e-724d-4f9c-800a-c376f51dd2f4)

- 변환된 장르의 배열과 비교했을 때 다른 모양이어서 console.log(typeof party.genres); 로 확인
  ![image (3)](https://github.com/user-attachments/assets/e6ebab5a-eea4-45da-8231-28b435e52770)

- 데이터가 배열이 아니라 string으로 들어오는 것을 확인하고 JSON.parse를 이용해 문자열에서 배열로 수정해서 해결함 (const genreFromStringToArray = JSON.parse(party.genres);)

</details>

<details>
<summary>팔로우 추천에서 팔로우 했다가 팔로우 취소한 유저가 추천 목록에 뜨는 문제</summary>

<br>_해결과정_<br>

- 팔로우 취소한 유저를 필터링하기위해 ban_recommend 테이블을 별도로 만들어 한 번 팔로우 했다가 취소한 유저를 필터링 할 수 있도록 수정

</details>

<details>
<summary>각 카드마다 닫기버튼을 클릭하면 카드가 삭제되어야 했는데 단순 필터링만 해주다 보니 삭제를 할 수 없는 문제</summary>

<br>_해결과정_<br>

- 로컬스토리지를 이용해 삭제한 카드목록을 로컬스토리지에 담아 필터링하고, 로컬스토리지에 담긴 데이터는 7일후에 삭제되도록 계획
- 로컬스토리지를 이용해 관리하는 것은 로그인상태같은 정보를 담는데에 사용하는데 적합하고 구현하려는 필터링 내용은 사용자가 재로그인을 하던, 다른 브라우저에서 실행하던 동일해야하므로 적절하지 않다는 피드백
- 팔로우 취소한 유저를 필터링하기위해 만든 ban_recommend활용해 닫기버튼을 눌렀을 때에도 테이블에 담아 필터링할 수 있도록 수정

</details>

</br>
